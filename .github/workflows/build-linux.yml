name: Build Linux App

on:
  push:
    branches: [atavism/update-makefile]
  pull_request:

jobs:
  build-linux:
    runs-on: ubuntu-latest

    steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Set up Go
          uses: actions/setup-go@v5
          with:
            go-version-file: "go.mod"

        - name: Install Linux dependencies
          run: |
            sudo apt-get update
            sudo apt-get install -y \
                build-essential \
                curl \
                git \
                unzip \
                clang \
                cmake \
                pkg-config \
                libgtk-3-dev \
                liblzma-dev \
                xz-utils \
                ninja-build \
                lld \
                libstdc++-12-dev \
                libgl1-mesa-dev \
                libegl1-mesa-dev \
                libayatana-appindicator3-dev \
                libcurl4-openssl-dev

        - name: Install the ninja build tool
          uses: seanmiddleditch/gha-setup-ninja@master

        - name: Install Flutter
          uses: subosito/flutter-action@v2
          with:
            channel: "stable"

        - name: Activate plugins
          run: |
            dart pub global activate protoc_plugin
            dart pub global activate flutter_distributor
    
        - name: Enable Flutter Desktop Support
          run: |
            flutter config --enable-linux-desktop

        - name: Build Linux release
          run: make linux-release