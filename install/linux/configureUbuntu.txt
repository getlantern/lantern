
# Install4J really just appends this to it's sh script, so don't do anything we can't do in sh!
# This is appended to /var/lib/dpkg/info/lantern.postinst

logf=~/.lantern.installer.log

sed -i s,^Icon=.*png$,Icon=/opt/lantern/128on.png, /opt/lantern/lantern.desktop
cp /opt/lantern/lantern.desktop /usr/share/applications || echo "Could not copy desktop file!!"  >> $logf
chown $SUDO_USER:$SUDO_USER /usr/share/applications/lantern.desktop
chmod 4711 /opt/lantern/copyPolicy.exe

test -e /opt/lantern/jre/jre1.* && mv /opt/lantern/jre/jre1.*/* /opt/lantern/jre

# Write .lantern-configurl.txt

# SUDO_COMMAND may look like this:
#     /usr/bin/dpkg -i /mnt/hgfs/ox.to.a.cart/Documents/eclipse_workspace/lantern/lantern-1234567890.deb
#
# Get the last element of the SUDO_COMMAND, which is our deb package
deb=`echo "${SUDO_COMMAND}" | sed 's/.* //'`
# Get the last portion of the filename after the last slash
deb=`echo "${deb}" | sed 's/.*\///'`
# Get the id by dropping the leading "lantern-" and the trailing ".deb"
len=${#deb}
len=$((len-8-4))
# Have to use this AWKward way of doing it because Ubuntu's sh points to dash
# See https://wiki.ubuntu.com/DashAsBinSh
id=$(echo $deb | awk '{ string=substr($0, 9, '"$len"'); print string; }')
# Write the id to the file
echo "${id}" > ~/.lantern-configurl.txt

echo "Finished running post install script..." >> $logf
